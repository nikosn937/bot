import streamlit as st
import pandas as pd
from io import StringIO
# Î”Î•Î Î§Î¡Î•Î™Î‘Î–Î•Î¤Î‘Î™ Î Î›Î•ÎŸÎ: from unidecode import unidecode 

# --------------------------------------------------------------------------------
# 1. Î•ÎÎ£Î©ÎœÎ‘Î¤Î©ÎœÎ•ÎÎŸ DATA SOURCE
# --------------------------------------------------------------------------------

CSV_DATA = """Keyword,Response
ÎœÎ±Î¸Î·Î¼Î±Ï„Î¹ÎºÎ¬,"Î•ÏÎ³Î±ÏƒÎ¯Î± ÎœÎ±Î¸Î·Î¼Î±Ï„Î¹ÎºÏÎ½: Î†ÏƒÎºÎ·ÏƒÎ· 33, ÏƒÎµÎ»Î¯Î´Î± 45. Î ÏÎ¿Î¸ÎµÏƒÎ¼Î¯Î±: Î Î±ÏÎ±ÏƒÎºÎµÏ…Î®."
Î¦Ï…ÏƒÎ¹ÎºÎ®,"Î”Î¹Î±Î³ÏÎ½Î¹ÏƒÎ¼Î± Î¦Ï…ÏƒÎ¹ÎºÎ®Ï‚ Ï„Î·Î½ Î¤ÏÎ¯Ï„Î· 25/10. ÎÎ»Î·: Î•Î½ÏŒÏ„Î·Ï„ÎµÏ‚ 1 & 2."
Î™ÏƒÏ„Î¿ÏÎ¯Î±,"Î•ÏÎ³Î±ÏƒÎ¯Î± Î™ÏƒÏ„Î¿ÏÎ¯Î±Ï‚: Î‘Î½Î¬Î³Î½Ï‰ÏƒÎ· ÎšÎµÏ†Î±Î»Î±Î¯Î¿Ï… 5 ÎºÎ±Î¹ ÏƒÎ·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚."
Î¤Î­Ï‡Î½Î·,"ÎÎ± Ï†Î­ÏÎµÏ„Îµ Ï„Î­ÏƒÏƒÎµÏÎ± Î¼Î¿Î»ÏÎ²Î¹Î± Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ®Ï‚ ÏƒÎºÎ»Î·ÏÏŒÏ„Î·Ï„Î±Ï‚ (B, 2B, H, 2H)."
Î•Î¾ÎµÏ„Î¬ÏƒÎµÎ¹Ï‚,"ÎŸÎ¹ ÎµÎ¾ÎµÏ„Î¬ÏƒÎµÎ¹Ï‚ Î±ÏÏ‡Î¯Î¶Î¿Ï…Î½ Ï„Î·Î½ 1Î· Î™Î¿Ï…Î½Î¯Î¿Ï…. Î˜Î± Î±Î½Î±ÏÏ„Î·Î¸ÎµÎ¯ Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î± ÏƒÏÎ½Ï„Î¿Î¼Î±."
Î©ÏÎ¬ÏÎ¹Î¿,"Î¤Î¿ Î¼Î¬Î¸Î·Î¼Î± Ï„ÎµÎ»ÎµÎ¹ÏÎ½ÎµÎ¹ ÏƒÏ„Î¹Ï‚ 14:00 ÏƒÎ®Î¼ÎµÏÎ±, Î»ÏŒÎ³Ï‰ Î³Î¹Î¿ÏÏ„Î®Ï‚."
Î•ÎºÎ´ÏÎ¿Î¼Î®,"Î— ÎµÎºÎ´ÏÎ¿Î¼Î® Î¸Î± Î³Î¯Î½ÎµÎ¹ Ï„Î·Î½ Î¤ÎµÏ„Î¬ÏÏ„Î· 15/11. ÎšÏŒÏƒÏ„Î¿Ï‚: 15â‚¬. ÎÎ± Ï†Î­ÏÎµÏ„Îµ Ï„Î·Î½ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ· Î¼Î­Ï‡ÏÎ¹ Ï„Î·Î½ Î Î±ÏÎ±ÏƒÎºÎµÏ…Î®."
Î¤Î±Î¼ÎµÎ¯Î¿,"Î¤Î¿ Ï„Î±Î¼ÎµÎ¯Î¿ Ï„Î·Ï‚ Ï„Î¬Î¾Î·Ï‚ Î­Ï‡ÎµÎ¹ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î¿ 85â‚¬. Î— ÎµÏ€ÏŒÎ¼ÎµÎ½Î· Ï€Î»Î·ÏÏ‰Î¼Î® (5â‚¬) ÎµÎ¯Î½Î±Î¹ ÏƒÏ„Î¹Ï‚ 3/11."
Î•ÎºÎ´Î·Î»ÏÏƒÎµÎ¹Ï‚,"Î¤Î·Î½ Î Î±ÏÎ±ÏƒÎºÎµÏ…Î® 27/10 Î¸Î± Ï€ÏÎ±Î³Î¼Î±Ï„Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î· ÏƒÏ‡Î¿Î»Î¹ÎºÎ® Î³Î¹Î¿ÏÏ„Î® Î³Î¹Î± Ï„Î·Î½ 28Î· ÎŸÎºÏ„Ï‰Î²ÏÎ¯Î¿Ï…. Î ÏÎ¿ÏƒÎ­Î»ÎµÏ…ÏƒÎ· 8:30 Ï€.Î¼. ÎºÎ±Î¹ Î±Ï€Î¿Ï‡ÏÏÎ·ÏƒÎ· 10:00 Ï€.Î¼."
Î‘Ï€Î¿Ï…ÏƒÎ¯ÎµÏ‚,"ÎŸ Î¼Î­Î³Î¹ÏƒÏ„Î¿Ï‚ ÎµÏ€Î¹Ï„ÏÎµÏ€ÏŒÎ¼ÎµÎ½Î¿Ï‚ Î±ÏÎ¹Î¸Î¼ÏŒÏ‚ Î±Ï€Î¿Ï…ÏƒÎ¹ÏÎ½ ÎµÎ¯Î½Î±Î¹ 114. Î“Î¹Î± Ï„Î¿Î½ Ï„ÏÎ­Ï‡Î¿Î½Ï„Î± Î¼Î®Î½Î±, Î· Ï„Î¬Î¾Î· Î¼Î±Ï‚ Î­Ï‡ÎµÎ¹ 12 Î±Î´Î¹ÎºÎ±Î¹Î¿Î»ÏŒÎ³Î·Ï„ÎµÏ‚ Î±Ï€Î¿Ï…ÏƒÎ¯ÎµÏ‚ ÏƒÏ…Î½Î¿Î»Î¹ÎºÎ¬."
Î’Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎ·,"Î— Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎ· ÎµÎ¯Î½Î±Î¹ Î±Î½Î¿Î¹Ï‡Ï„Î® ÎºÎ¬Î¸Îµ Î¤ÎµÏ„Î¬ÏÏ„Î· (13:00-14:00). Î¤Î¿ Î²Î¹Î²Î»Î¯Î¿ 'ÎŸ Î¼ÎµÎ³Î¬Î»Î¿Ï‚ Ï€ÎµÏÎ¯Ï€Î±Ï„Î¿Ï‚ Ï„Î¿Ï… Î Î­Ï„ÏÎ¿Ï…' Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÏ€Î¹ÏƒÏ„ÏÎ±Ï†ÎµÎ¯ Î¬Î¼ÎµÏƒÎ±."
Î‘Î½Î±ÎºÎ¿Î¹Î½ÏÏƒÎµÎ¹Ï‚,"Î¥Ï€ÎµÎ½Î¸Ï…Î¼Î¯Î¶ÎµÏ„Î±Î¹ ÏƒÎµ ÏŒÎ»Î¿Ï…Ï‚ Ï„Î¿Ï…Ï‚ Î¼Î±Î¸Î·Ï„Î­Ï‚ Î· Î±Ï€Î±Î³ÏŒÏÎµÏ…ÏƒÎ· Ï‡ÏÎ®ÏƒÎ·Ï‚ ÎºÎ¹Î½Î·Ï„ÏÎ½ Ï„Î·Î»ÎµÏ†ÏÎ½Ï‰Î½ ÎºÎ±Ï„Î¬ Ï„Î· Î´Î¹Î¬ÏÎºÎµÎ¹Î± Ï„Ï‰Î½ Î¼Î±Î¸Î·Î¼Î¬Ï„Ï‰Î½."
"""

# --------------------------------------------------------------------------------
# 2. Î’ÎŸÎ—Î˜Î—Î¤Î™ÎšÎ— Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î— (Î§Î©Î¡Î™Î£ unidecode)
# --------------------------------------------------------------------------------

# Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ¼Îµ Î±Ï€Î»Î® Î¼Î­Î¸Î¿Î´Î¿ Î±Î½Ï„Î¹ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚ Ï„ÏŒÎ½Ï‰Î½, Î· Î¿Ï€Î¿Î¯Î± ÎµÎ¯Î½Î±Î¹ ÎµÎ½ÏƒÏ‰Î¼Î±Ï„Ï‰Î¼Î­Î½Î·.
TONES_MAP = str.maketrans("Î¬Î­Î®Î¯ÏŒÏÏ", "Î±ÎµÎ·Î¹Î¿Ï…Ï‰")

def normalize_keyword(keyword):
    """ÎœÎµÏ„Î±Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î· Î»Î­Î¾Î·-ÎºÎ»ÎµÎ¹Î´Î¯ ÏƒÎµ Ï€ÎµÎ¶Î¬ ÎºÎ±Î¹ Î±Ï†Î±Î¹ÏÎµÎ¯ Ï„Î¿Ï…Ï‚ Ï„ÏŒÎ½Î¿Ï…Ï‚ Î¼Îµ ÎµÎ½ÏƒÏ‰Î¼Î±Ï„Ï‰Î¼Î­Î½Î· Î¼Î­Î¸Î¿Î´Î¿."""
    if pd.isna(keyword):
        return ''
    # 1. ÎœÎµÏ„Î±Ï„ÏÎ¿Ï€Î® ÏƒÎµ Ï€ÎµÎ¶Î¬
    normalized = str(keyword).lower().strip()
    # 2. Î‘Ï†Î±Î¯ÏÎµÏƒÎ· Ï„ÏŒÎ½Ï‰Î½ (Ï€.Ï‡. 'Ï†Ï…ÏƒÎ¹ÎºÎ®' -> 'Ï†Ï…ÏƒÎ¹ÎºÎ·')
    return normalized.translate(TONES_MAP)


# --------------------------------------------------------------------------------
# 3. Î¦ÎŸÎ¡Î¤Î©Î£Î— ÎšÎ‘Î™ Î•Î Î•ÎÎ•Î¡Î“Î‘Î£Î™Î‘ Î”Î•Î”ÎŸÎœÎ•ÎÎ©Î
# --------------------------------------------------------------------------------

try:
    df = pd.read_csv(StringIO(CSV_DATA))
    
    df.columns = df.columns.str.strip()
    
    if 'Keyword' not in df.columns or 'Response' not in df.columns:
        raise ValueError("Î£Ï†Î¬Î»Î¼Î±: Î›ÎµÎ¯Ï€Î¿Ï…Î½ Î¿Î¹ ÎµÏ€Î¹ÎºÎµÏ†Î±Î»Î¯Î´ÎµÏ‚ 'Keyword' Î® 'Response'.")
    
    # Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¿ÏÎ¼Îµ Ï„Î· ÏƒÏ„Î®Î»Î· Î³Î¹Î± ÎµÏƒÏ‰Ï„ÎµÏÎ¹ÎºÎ® ÏƒÏÎ³ÎºÏÎ¹ÏƒÎ· (ÎµÎ´Ï Î³Î¯Î½ÎµÏ„Î±Î¹ Î· Î±Ï†Î±Î¯ÏÎµÏƒÎ· Ï„ÏŒÎ½Ï‰Î½)
    df['Normalized_Keyword'] = df['Keyword'].apply(normalize_keyword)
    
    data_source_dict = df.set_index('Normalized_Keyword')['Response'].to_dict()
    
    available_keys_display = sorted(df['Keyword'].unique())
    
except Exception as e:
    st.error(f"ÎšÏÎ¯ÏƒÎ¹Î¼Î¿ Î£Ï†Î¬Î»Î¼Î± Î”Î¿Î¼Î®Ï‚: {e}")
    data_source_dict = {}
    available_keys_display = []

# --------------------------------------------------------------------------------
# 4. UI / Î›ÎŸÎ“Î™ÎšÎ—
# --------------------------------------------------------------------------------

st.set_page_config(page_title="Î’Î¿Î·Î¸ÏŒÏ‚ Î¤Î¬Î¾Î·Ï‚ (Î¤ÎµÎ»Î¹ÎºÎ® ÎˆÎºÎ´Î¿ÏƒÎ·)", layout="centered")
st.title("ğŸ¤– Î¨Î·Ï†Î¹Î±ÎºÏŒÏ‚ Î’Î¿Î·Î¸ÏŒÏ‚ Î¤Î¬Î¾Î·Ï‚")
st.markdown("---")

info_message = f"Î“ÎµÎ¹Î±! Î•Î¯Î¼Î±Î¹ Î¿ Î²Î¿Î·Î¸ÏŒÏ‚ ÏƒÎ¿Ï…. Î”Î¿ÎºÎ¯Î¼Î±ÏƒÎµ Î¼Î¯Î± Î±Ï€ÏŒ Ï„Î¹Ï‚ Î»Î­Î¾ÎµÎ¹Ï‚-ÎºÎ»ÎµÎ¹Î´Î¹Î¬: **{', '.join(available_keys_display)}**"
st.info(info_message)

if 'search_query' not in st.session_state:
    st.session_state.search_query = ""

user_input = st.text_input(
    'Î¤Î¹ Î¸Î­Î»ÎµÎ¹Ï‚ Î½Î± Î¼Î¬Î¸ÎµÎ¹Ï‚;', 
    placeholder='Î Î»Î·ÎºÏ„ÏÎ¿Î»ÏŒÎ³Î·ÏƒÎµ Ï€.Ï‡. ÎœÎ±Î¸Î·Î¼Î±Ï„Î¹ÎºÎ¬, Î•ÎºÎ´ÏÎ¿Î¼Î®...',
    key='main_input',
    value=st.session_state.search_query
)

if st.button('Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·'):
    processed_input = normalize_keyword(user_input)
    
    if processed_input in data_source_dict:
        bot_response = data_source_dict[processed_input]
        st.success(f"**Î‘Ï€Î¬Î½Ï„Î·ÏƒÎ·:** {bot_response}")
        
        st.session_state.search_query = ""
        st.rerun() 
        
    else:
        st.warning(
            f"Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· Î³Î¹Î± Ï„Î¿: '{user_input}'. Î”Î¿ÎºÎ¯Î¼Î±ÏƒÎµ Î¼Î¯Î± Î±Ï€ÏŒ Ï„Î¹Ï‚ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚ Î»Î­Î¾ÎµÎ¹Ï‚-ÎºÎ»ÎµÎ¹Î´Î¹Î¬: **{', '.join(available_keys_display)}**."
        )

st.markdown("---")
st.caption("Î— ÎµÏ†Î±ÏÎ¼Î¿Î³Î® Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Python/Streamlit Î¼Îµ ÎµÎ½ÏƒÏ‰Î¼Î±Ï„Ï‰Î¼Î­Î½Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±.")
